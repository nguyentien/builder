/**
 * CoffeeBuilder - v0.1.3 - 2012-12-12
 * Copyright (c) 2006-2012  CoffeeCup Software, Inc. (http://www.coffeecup.com/)
 */
!function(e,t,n){"use strict";var r=function(){this.length=0,this.keys=[],this.items={}};r.prototype={constructor:r,add:function(t,r,i){return e.inArray(t,this.keys)!==-1&&e.error("Index already defined: "+t),i===n&&(i=this.length),i>this.length&&e.error("Position is larger than collection length: "+i),i===this.length?this.keys.push(t):this.keys.splice(i,0,t),this.items[t]=r,this.length++,this.items[t]},remove:function(e){var t=this.getIndex(e),n=this.items[t.named];return this.keys.splice(t.numeric,1),delete this.items[t.named],this.length--,n},get:function(e){return this.items[this.getIndex(e).named]},getIndex:function(e){return typeof e=="number"?{numeric:e,named:this.getKeyForIndex(e)}:{numeric:this.getIndexForKey(e),named:e}},getKeyForIndex:function(t){if(typeof t=="number"&&t===~~t&&t<this.length)return this.keys[t];e.error("Invalid index provided: "+t)},getIndexForKey:function(t){var n=e.inArray(t,this.keys);if(n!==-1)return n;e.error("Invalid index provided: "+t)}};var i={observerCollection:{},addObserver:function(t,n){e.isFunction(n)||e.error("observer must be a function"),e.isArray(this.observerCollection[t])||(this.observerCollection[t]=[]),this.observerCollection[t].push(n)},removeObserver:function(t,n){if(arguments.length===1){var r=this;n=t,e.each(this.observerCollection,function(e){r.removeObserver(e,n)});return}e.isArray(this.observerCollection[t])||e.error("invalid observer: "+t),this.observerCollection[t]=e.grep(this.observerCollection[t],function(e){return e!==n})},postNotification:function(t){if(!e.isArray(this.observerCollection[t]))return;var n=Array.prototype.slice.call(arguments,1);e.each(this.observerCollection[t],function(e,t){t.apply(null,n)})}},s=function(e){this.rules={}};s.prototype={constructor:s,addRule:function(e,t,n){this.rules.hasOwnProperty(e)||(this.rules[e]={}),this.rules[e][t]=n},merge:function(t){e.extend(!0,this.rules,t.getRules())},removeRule:function(e,t){this.rules.hasOwnProperty(e)&&delete this.rules[e][t]},removeRulesForSelector:function(e){delete this.rules[e]},clearRules:function(){this.rules={}},getRules:function(){return this.rules},toString:function(){var t="";return e.each(this.rules,function(n,r){t+=n+"{"+"\n",e.each(r,function(e,n){t+="	"+e+":"+n+";"+"\n"}),t+="}\n"}),e.trim(t)}};var o=function(t,i){this.setOptions(i),this.panels=new r,this.current=n,t.length!==1&&e.error("CoffeeBuilder requires exactly one iframe"),this.$element=t,this.$contents=this.$element.contents(),this.$center=e("#layout-center"),this.$blocker=e('<div id="builder_blocker">'),this.$controls=e('<div class="ui-layout-east" id="controls">'),this.$controlset=e('<form id="controlset" class="tabsform" method="get" action=""></form>'),this.$switcher=e('<ul id="control_switcher">'),this.$prev=e('<div id="control_prev">').click(e.proxy(this,"prev")),this.$next=e('<div id="control_next">').click(e.proxy(this,"next")),this.build()};o.prototype={constructor:o,build:function(){var n=this;return e.each(["$next","$prev","$switcher","$controlset"],function(e,t){n.$controls.append(n[t])}),e.each(["$controls","$blocker"],function(e,t){n.$center.after(n[t])}),n.buildIframe(),n.addPanels(),n.data(this.options.data),e(t).resize(e.proxy(n.windowResize,n)).resize(),n},setOptions:function(e){this.options=e||{},this.manifest=this.options.manifest||{},this.width=this.options.width||332,this.design_mode=this.options.design_mode||!1,this.options.data=this.options.data||{}},buildIframe:function(){this.$blocker.css("width",this.width),this.$styles=e('<style id="coffeebuilder_styles">').appendTo(this.$contents.find("head")),this.toggleDesignMode(this.design_mode),this.put=put.forDocument(this.$contents.get(0)),this.$mock_area=e('<div id="coffee_mocker">').css({height:0,overflow:"hidden",position:"absolute"}).appendTo(this.$contents.find("body"))},windowResize:function(e){return h.get("window_resize")(e,this)},change:function(){e.each(this.panels.items,function(e,t){t.change()})},getStyleSheet:function(t){var n=new s;return e.each(this.panels.items,function(e,r){n.merge(r.getStyleSheet(t))}),n},getStyleSheetForPanel:function(e,t){return this.panels.get(e).getStyleSheet(t)},getStyleSheetForPanelControl:function(e,t,n){return this.panels.get(e).getStyleSheetForControl(t,n)},getStyleSheetForSubPanel:function(e,t,n){return this.panels.get(e).getStyleSheetForPanel(t,n)},getStyleSheetForSubPanelControl:function(e,t,n,r){return this.panels.get(e).getStyleSheetForPanelControl(t,n,r)},refresh:function(t){var r=this;r.$contents=r.$element.contents();if(t===n){r.change();return}e.each(r.panels.items,function(e,t){r.removePanel(e)}),r.setOptions(t),r.buildIframe(),r.addPanels(),r.data(this.options.data)},activatePanelByElement:function(e){var t=this.findPanelWithElementControl(e);t.panel!==n&&(this.activatePanel(t.panel),t.subpanel!==n&&this.panels.get(t.panel).activatePanel(t.subpanel))},findPanelWithElementControl:function(t){var r={panel:n,subpanel:n};return e.each(this.panels.items,function(e,i){if((r=i.findElementControl(t)).panel!==n)return!1}),r},disable:function(){this.$blocker.show()},enable:function(){this.$blocker.hide()},addPanel:function(e,t){this.panels.add(e,(new u(e,t)).build(this)),this.current===this.panels.length-2&&this.$next.addClass("active")},addSubPanel:function(e,t,n){this.panels.get(e).addSubPanel(this,t,n)},addControlToPanel:function(e,t,n){this.panels.get(e).addControl(this,t,n)},addControlToSubPanel:function(e,t,n,r){this.panels.get(e).addControlToPanel(this,t,n,r)},data:function(t){var n=arguments.length>0;return t=t||{},e.each(this.panels.items,function(r,i){n?i.data(t):e.extend(t,i.data())}),t},dataForPanel:function(e,t){return this.panels.get(e).data(t)},dataForPanelControl:function(e,t,n){return this.panels.get(e).dataForControl(t,n)},dataForSubPanel:function(e,t,n){return this.panels.get(e).dataForPanel(t,n)},dataForSubPanelControl:function(e,t,n,r){return this.panels.get(e).dataForPanelControl(t,n,r)},addPanels:function(){var t=this;t.manifest.panels||e.error("Invalid manifest: no panels provided"),t.panels.length&&e.error("`CoffeeBuilder.addPanels` should only be used when no panels exist"),e.each(t.manifest.panels,function(e,n){t.addPanel(e,n)}),t.activatePanel(0)},removePanel:function(e){var t=this.panels.getIndex(e);this.current===t.numeric&&(this.canPrev()?this.prev():this.canNext()?this.next():this.current=n),this.panels.remove(e).destroy(this),this.current!==n&&this.setActive(this.current>t.numeric?this.current-1:this.current)},removeSubPanel:function(e,t){this.panels.get(e).removePanel(this,t)},removeControlFromPanel:function(e,t){this.panels.get(e).removeControl(t)},removeControlFromSubPanel:function(e,t,n){this.panels.get(e).removeControlFromPanel(t,n)},activatePanel:function(t){if(t instanceof e)return this.activatePanelByElement(t);this.current!==n&&this.panels.get(this.current).deactivate(),this.setActive(t)},activateSubPanel:function(e){this.panels.get(this.current).activatePanel(e)},setActive:function(e){this.current=this.panels.getIndex(e).numeric,this.$next.toggleClass("active",this.canNext()),this.$prev.toggleClass("active",this.canPrev()),this.panels.get(e).activate()},prev:function(){this.canPrev()&&this.activatePanel(this.current-1)},next:function(){this.canNext()&&this.activatePanel(this.current+1)},canPrev:function(){return this.current>0},canNext:function(){return this.current<this.panels.length-1},toggleDesignMode:function(t){var r=this;r.design_mode=t===n?!r.design_mode:Boolean(t),r.design_mode?r.$contents.find("*").bind("click.coffeeBuilder",function(t){return t.preventDefault(),r.activatePanelByElement(e(this)),!1}):r.$contents.find("*").unbind("click.coffeeBuilder")},mockElement:function(t){if(typeof t!="string"||t.length===0)return;e.inArray(t.charAt(0),[".","#","[","!"])!==-1&&(t="div"+t),this.put(this.$mock_area.get(0),t)}};var u=function(t,i){this.manifest=i,this.name=t,this.panels=new r,this.current=n,this.controls=new r,this.$title=e('<li id="'+this.name+'">').text(this.manifest.name),this.$controls=e('<div id="'+this.name+'_controls" class="controlpane">'),this.$fieldset=e('<fieldset class="panelset">'),this.$subswitcher=e('<ul class="control_toolbar" id="'+this.name+'_subpanel">'),this.manifest.name||e.error("Invalid manifest: no name provided")};u.prototype={constructor:u,build:function(t){var n=this;return t.$switcher.append(n.$title),n.manifest.subpanels?(t.$switcher.after(n.$subswitcher),e.each(n.manifest.subpanels,function(e,r){n.addSubPanel(t,e,r)}),n):(t.$controlset.append(n.$controls),n.$controls.append(n.$fieldset),n.manifest.customizations&&e.each(n.manifest.customizations,function(e,r){n.addControl(t,e,r)}),n)},destroy:function(t){this.$title.remove(),this.$controls.remove(),this.$subswitcher.remove(),e.each(this.panels.items,function(e,n){n.destroy(t)})},addControl:function(e,t,n){typeof n=="object"&&typeof n.position=="number"&&n.position<this.controls.length?this.controls.add(t,c.get(e,this,t,n).build(this.controls.get(n.position).$element),n.position):this.controls.add(t,c.get(e,this,t,n).build())},addControlToPanel:function(e,t,n,r){return this.panels.get(t).addControl(e,n,r)},removeControl:function(e){this.controls.get(e).$element.remove()},addSubPanel:function(e,t,n){this.panels.add(t,(new a(t,n)).build(e,this)),h.get("subpanels_change")(e,this)},change:function(){e.each(this.controls.items,function(e,t){t.change()}),e.each(this.panels.items,function(e,t){t.change()})},getStyleSheet:function(t){var n=new s;return e.each(this.controls.items,function(e,r){n.merge(r.getStyleSheet(t))}),e.each(this.panels.items,function(e,r){n.merge(r.getStyleSheet(t))}),n},data:function(t){var n=arguments.length>0;return t=t||{},e.each(this.controls.items,function(r,i){n?i.data(t):e.extend(t,i.data())}),e.each(this.panels.items,function(r,i){n?i.data(t):e.extend(t,i.data())}),t},getStyleSheetForControl:function(e,t){return this.controls.get(e).getStyleSheet(t)},dataForControl:function(e,t){return this.controls.get(e).data(t)},activate:function(){this.$title.addClass("active"),this.controls.length?this.$controls.addClass("active"):this.panels.length&&(this.$subswitcher.addClass("active"),typeof this.current!="number"&&this.activatePanel(0))},deactivate:function(){this.$title.removeClass("active"),this.controls.length?this.$controls.removeClass("active"):this.panels.length&&(this.$subswitcher.removeClass("active"),this.current!==n&&(this.panels.get(this.current).deactivate(),this.current=n))},findElementControl:function(t){var r=this,i={panel:n,subpanel:n};return r.controls.length?e.each(r.controls.items,function(e,n){if(n.hasElement(t))return i.panel=r.name,!1}):r.panels.length&&(i=r.findPanelWithElementControl(t)).panel!==n&&(i={panel:r.name,subpanel:i.panel}),i},removePanel:function(e,t){o.prototype.removePanel.call(this,t),h.get("subpanels_change")(e,this)},setActive:function(e){this.current=this.panels.getIndex(e).numeric,this.panels.get(e).activate()},findPanelWithElementControl:o.prototype.findPanelWithElementControl,removeControlFromPanel:o.prototype.removeControlFromPanel,activatePanel:o.prototype.activatePanel,prev:o.prototype.prev,next:o.prototype.next,canPrev:o.prototype.canPrev,canNext:o.prototype.canNext,getStyleSheetForPanel:o.prototype.getStyleSheetForPanel,getStyleSheetForPanelControl:o.prototype.getStyleSheetForPanelControl,dataForPanel:o.prototype.dataForPanel,dataForPanelControl:o.prototype.dataForPanelControl};var a=function(e,t){u.call(this,e,t)};a.prototype=e.extend({},u.prototype,{constructor:a,build:function(t,n){var r=this;return r.$title.attr("id",n.name+"_subpanel_"+r.name+"_title").click(function(){n.activatePanel(r.name)}),n.$subswitcher.append(r.$title),r.$controls.attr("id",n.name+"_subpanel_"+r.name+"_controls"),t.$controlset.append(r.$controls),r.$fieldset.attr("class","sub_panelset"),r.$controls.append(r.$fieldset),r.manifest.customizations&&e.each(r.manifest.customizations,function(e,n){r.addControl(t,e,n)}),r},activate:function(){this.$title.addClass("active"),this.$controls.addClass("active")},deactivate:function(){this.$title.removeClass("active"),this.$controls.removeClass("active")}});var f=function(t,n,r,i,o){this.builder=t,this.panel=n,this.name=r,this.manifest=i,this.group=o,this.$element=e(),this.fields={},this.props={css:[],data:{}},this.stylesheet=new s,e.isFunction(this.init)&&this.init()};f.getSelector=function(t){var r={selector:n,property:n};return t.selectors&&e.each(t.selectors,function(e,t){if(e.indexOf(":")===-1)return r={selector:e,property:t[0]},!1}),r},f.prototype={constructor:f,build:function(e){return this.$element.length&&(e!==n?this.$element.insertBefore(e.eq(0)):this.$element.appendTo(this.panel.$fieldset)),this},getCss:function(e){var t=null,n=null,r=null,i=this.getSelector(),s=this.getElement();e=e||i.property;if(!i.selector||!e)return null;s.length===0&&(this.builder.mockElement(i.selector),s=this.getElement());var o=e.match(/^(border.*)(?:-(?:color|width))$/);return o&&s.css(o[1]+"-style")==="none"&&(n={property:o[1]+"-style",value:"none"},t=s.attr("style")||"",s.css(n.property,"solid")),r=s.css(e),typeof r=="string"&&r.match(/^rgba?\(.*?\)$/)&&(r=this.getHexAlpha(r).hex),n&&(s.css(n.property,n.value),s.attr("style",t)),r},updateCss:function(t,r){var s=this;arguments.length===1&&(r=t,t=r);if(s.manifest.selectors===n)return;e.each(s.manifest.selectors,function(e,n){if(t)return s.stylesheet.addRule(e,t,r),i.postNotification("updateCss",e,t,r),!0;for(var o=0;o<n.length;o++)s.stylesheet.addRule(e,n[o],r),i.postNotification("updateCss",e,n[o],r)});var o=s.builder.getStyleSheet().toString();s.builder.$styles[0].styleSheet?s.builder.$styles[0].styleSheet.cssText=o:s.builder.$styles.html(o)},hasElement:function(t){var r=this,i=!1,s=t.get(0),o;return r.manifest.selectors!==n&&e.each(r.manifest.selectors,function(e,t){if(e.indexOf(":")!==-1||!(o=r.builder.$contents.find(e)).length)return!1;o.each(function(){if(this===s)return i=!0,!1})}),i},getElement:function(t){var n=this.getSelector();if(!n.selector)return e();var r=this.builder.$contents.find(n.selector);return t&&r.parent().is("#coffee_mocker")?e():r},updateTextElement:function(e){this.getElement().text(e)},getHexAlpha:function(e){var t={hex:n,alpha:n},r=/rgba?\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)(?:,\s*([\d\.]+))?/.exec(e);return r&&(t={hex:"#"+(1<<24|r[1]<<16|r[2]<<8|r[3]).toString(16).substr(1),alpha:r[4]}),t},getRgb:function(e){var t=parseInt(e.substr(1),16);return(t>>16&255)+", "+(t>>8&255)+", "+(t&255)},getSelector:function(){return f.getSelector(this.manifest)},setTitle:function(e){return e.toggleClass("section_head",!this.manifest.weak_label).append(t.document.createTextNode(" "+this.manifest.name+":"))},change:function(){e.each(this.fields,function(e,t){t.change()})},getStyleSheet:function(t){if(!t)return this.stylesheet;var r=this,i=new s;if(r.manifest.selectors===n)return i;if(r.props.css.length!==0)e.each(r.props.css,function(t,n){var s=r.getCss(n);e.each(r.manifest.selectors,function(e){i.addRule(e,n,s)})});else{var o=r.getCss();e.each(r.manifest.selectors,function(e,t){for(var n=0;n<t.length;n++)i.addRule(e,t[n],o)})}return i},addData:function(e,t){var r={};this.props.data[e]=n,r[e]=t,this.data(r)},data:function(t){var n=this,r=arguments.length>0;return t=t||{},r&&e.each(t,function(t,r){n.props.data.hasOwnProperty(t)&&n.props.data[t]!==r&&(e.isFunction(n.dataChanged)&&(r=n.dataChanged(t,r)),n.props.data[t]=r,i.postNotification("data",t,r))}),n.props.data}};var l=function(t,n,i,s){var o=this;o.controls=new r,f.call(o,t,n,i,s),o.$element=e('<div class="control_group">'),s.customizations&&e.each(s.customizations,function(e,r){var i=c.get(t,n,e,r,o);o.controls.add(e,i),o.$element.append(i.$element)})};l.prototype=e.extend({},f.prototype,{constructor:l,change:function(){e.each(this.controls.items,function(e,t){t.change()})},getStyleSheet:function(t){var n=new s;return e.each(this.controls.items,function(e,r){n.merge(r.getStyleSheet(t))}),n},data:function(t){var n=arguments.length>0;return t=t||{},e.each(this.controls.items,function(r,i){n?i.data(t):e.extend(t,i.data())}),t},hasElement:function(t){var n=!1;return this.controls.length&&e.each(this.controls.items,function(e,r){if(r.hasElement(t))return n=!0,!1}),n}});var c={controls:{},pristine:{},add:function(t,n){(!n||!e.isFunction(n.init)||!e.isFunction(n.check))&&e.error("Invalid control provided"),this.pristine[t]=n,this.controls[t]=function(e,t,n,r,i){f.call(this,e,t,n,r,i)},this.controls[t].prototype=e.extend({},n,f.prototype,{constructor:this.controls[t]}),this.controls[t].check=n.check},get:function(t,n,r,i,s){s=s||{},i.name||e.error("Invalid control: no name provided");if(i.type==="group")return new l(t,n,r,i);var o=f;return e.each(this.controls,function(e,t){if(t.check(i))return o=t,!1}),new o(t,n,r,i,s)},getPristine:function(t){return e.isPlainObject(this.pristine[t])||e.error("Invalid index provided: "+t),this.pristine[t]}};c.add("size",{check:function(e){return typeof e["default"]=="string"&&e["default"].match(/^\d+px$/)},init:function(){var t=this.manifest.options||[],n=t.min||"0",r=t.max||"1000",i=this.getCss()||t["default"]||n;this.$element=e('<label class="label_input"><span class="primary_left"></span><input type="number" class="input_right size_field"></label>'),this.fields.input=this.$element.find("input"),this.setTitle(this.$element.find("span:first")),h.get("initialize_sizers")(this.fields.input.attr({name:this.name,value:parseInt(i,10),min:n,max:r,maxlength:r.length}).change(e.proxy(this.inputChange,this)).keyup(e.proxy(this.inputKeyup,this)))},inputChange:function(e){return h.get("sizer_change")(e,this)},inputKeyup:function(e){return h.get("sizer_keyup")(e,this)}}),c.add("text",{check:function(e){return e.type==="text"},init:function(){var t=this.manifest.options||[],n="",r=this.getCss("font-family")||"Helvetica, Arial, sans-serif",i=this.getCss("font-size")||"13px",s=this.getCss("color")||"#000000",o=this.getElement();e.each({Arial:"Arial, Helvetica, sans-serif",Baskerville:"Baskerville, 'Times New Roman', Times, serif",Cambria:"Cambria, Georgia, Times, 'Times New Roman', serif","Century Gothic":"'Century Gothic', 'Apple Gothic', sans-serif",Consolas:"Consolas, 'Lucida Console', Monaco, monospace","Copperplate Light":"'Copperplate Light', 'Copperplate Gothic Light', serif","Courier New":"'Courier New', Courier, monospace","Franklin Gothic Medium":"'Franklin Gothic Medium', 'Arial Narrow Bold', Arial, sans-serif",Futura:"Futura, 'Century Gothic', AppleGothic, sans-serif",Garamond:"Garamond, 'Hoefler Text', 'Times New Roman', Times, serif",Geneva:"Geneva, 'Lucida Sans', 'Lucida Grande', 'Lucida Sans Unicode', Verdana, sans-serif",Georgia:"Georgia, Palatino, 'Palatino Linotype', Times, 'Times New Roman', serif","Gill Sans":"'Gill Sans', Calibri, 'Trebuchet MS', sans-serif",Helvetica:"Helvetica, Arial, sans-serif",Impact:"Impact, Haettenschweiler, 'Arial Narrow Bold', sans-serif","Lucida Sans":"'Lucida Sans', 'Lucida Grande', 'Lucida Sans Unicode', sans-serif",Palatino:"Palatino, 'Palatino Linotype', Georgia, Times, 'Times New Roman', serif",Tahoma:"Tahoma, Geneva, Verdana",Times:"Times, 'Times New Roman', Georgia, serif","Trebuchet MS":"'Trebuchet MS', 'Lucida Sans Unicode', 'Lucida Grande', 'Lucida Sans', Arial, sans-serif",Verdana:"Verdana, Geneva, Tahoma, sans-serif"},function(e,t){n+='<option value="'+t+'" title="'+t+'">'+e+"</option>"}),this.properties=["font-family","font-size","color"],this.$element=e('<div class="control_group text_group"> <label class="label_input"><span class="primary_left"></span><input type="text" class="input_right description_text" maxlength="36"></label> <label class="label_grouped_main"><span class="primary_left">Font:</span><select class="combo_right combo_font select_field">'+n+"</select></label>"+' <label class="label_grouped"><input class="input_right size_field combo_color_and_size" type="text" min="8" max="80" maxlength="2"></label>'+' <label class="label_grouped"><input type="text" class="color_right color_picker"></label>'+"</div>"),this.fields={family:this.$element.find("select").val(r),size:this.$element.find("input.size_field").val(parseInt(i,10)),input:this.$element.find("input.description_text"),color:this.$element.find("input.color_picker").val(s)},this.setTitle(this.$element.find("span:first")),h.get("colorpicker_initialize")(this,this.fields.color,"color"),o.length?(this.fields.input.val(o.text()).change(e.proxy(this.textChange,this)).keyup(e.proxy(this.textChange,this)),this.fields.family.change(e.proxy(this.fontFamilyChange,this)),h.get("initialize_sizers")(this.fields.size.change(e.proxy(this.fontSizeChange,this)).keyup(e.proxy(this.fontSizeKeyup,this)))):e.each(this.fields,function(e,t){t.attr("disabled",!0)})},fontSizeChange:function(e){return h.get("sizer_change")(e,this,"font-size")},fontSizeKeyup:function(e){return h.get("sizer_keyup")(e,this,"font-size")},fontFamilyChange:function(e){return h.get("select_change")(e,this,"font-family")},textChange:function(e){return h.get("text_change")(e,this)}}),c.add("shadow",{check:function(e){return f.getSelector(e).property==="box-shadow"},init:function(){var t=this,r=t.getCss();t.$element=e('<div class="control_group shadow_group"> <label class="label_input_grouped"><span class="primary_left section_head"><input class="shadow_enabled shadow_checkbox" type="checkbox"></span></label> <label class="label_input_grouped"><input type="text" class="color_right color_picker shadow_color" value="#777777"></label> <label class="label_input_grouped"><input class="input_right shadow_size shadow_opacity" type="text" value="90" min="0" max="100" maxlength="3"><span class="shadow_text">%</span></label> <label class="label_input_grouped"><input class="input_right shadow_size shadow_x" type="text" value="2" min="0" max="10" maxlength="2"></label> <label class="label_input_grouped"><input class="input_right shadow_size shadow_y" type="text" value="2" min="0" max="10" maxlength="2"></label> <label class="label_input_grouped"><input class="input_right shadow_size shadow_blur" type="text" value="5" min="0" max="10" maxlength="2"></label> <span class="shadow_label first">Alpha</span><span class="shadow_label">X</span><span class="shadow_label">Y</span><span class="shadow_label">Blur</span></div>'),e.each(["checkbox","color","opacity","x","y","blur"],function(e,n){t.fields[n]=t.$element.find("input.shadow_"+n)}),t.setTitle(t.$element.find("span:first"));if(r&&r!=="none"){t.fields.checkbox.attr("checked","checked");var i=t.getHexAlpha(r);i.hex&&(t.fields.color.val(i.hex),t.fields.opacity.val(Math.round((i.alpha?i.alpha:1)*100)));var s=r.match(/(\d+)px\s+(\d+)px\s+(\d+)px\s+(\d+)px/);s&&(t.fields.x.val(s[1]),t.fields.y.val(s[2]),t.fields.blur.val(s[3]))}t.fields.checkbox.change(e.proxy(t.checkboxChange,t)).change(),h.get("colorpicker_initialize")(t,t.fields.color,n,{},e.proxy(t.shadowChange,t)),e.each(t.fields,function(n,r){n!=="checkbox"&&n!=="color"&&h.get("initialize_sizers")(r.change(e.proxy(t.sizerChange,t)).keyup(e.proxy(t.sizerKeyup,t)))})},sizerChange:function(t){return h.get("sizer_change")(t,this,n,e.proxy(this.shadowChange,this))},sizerKeyup:function(t){return h.get("sizer_keyup")(t,this,n,e.proxy(this.shadowChange,this))},shadowChange:function(){return h.get("shadow_change")(this)},checkboxChange:function(e){return h.get("shadow_checkbox")(this)}}),c.add("border",{check:function(t){return e.inArray(f.getSelector(t).property,["border-top","border-bottom","border-left","border-right","border"])!==-1},init:function(){var t,r="",i=!1,s=this,o=s.getSelector(),u=s.getCss(o.property+"-style")||"none",a=s.getCss(o.property+"-width")||"0",f=s.getCss(o.property+"-color")||"#000000";e.each({None:"none",Dotted:"dotted",Dashed:"dashed",Solid:"solid",Double:"double",Groove:"groove",Ridge:"ridge",Inset:"inset",Outset:"outset"},function(e,t){r+='<option value="'+t+'" title="'+e+'">'+e+"</option>"}),s.$element=e('<label class="label_grouped_main"><span class="primary_left"></span><select class="combo_right combo_font select_field">'+r+"</select></label>"+'<label class="label_grouped"><input class="input_right size_field combo_color_and_size" type="text" min="0" max="20" value="13" maxlength="2">%</label>'+'<label class="label_grouped"><input type="text" class="color_right color_picker"></label>'),this.$element.find("span:first").text(s.manifest.name+":"),s.fields={style:this.$element.find("select").val(u),width:this.$element.find("input.size_field").val(parseInt(a,10)),color:this.$element.find("input.color_picker").val(f)},e.each(["style","width","color"],function(e,t){s[t+"_property"]=o.property+"-"+t}),s.fields.style.change(e.proxy(s.styleChange,s)),h.get("initialize_sizers")(s.fields.width.change(e.proxy(s.widthChange,s)).keyup(e.proxy(s.widthKeyup,s))),h.get("colorpicker_initialize")(s,s.fields.color,s.color_property,n,e.proxy(s.colorChangeAll,s)),s.group&&(s.group.controls.length===0?(s.locked=!0,s.$lock=e('<span class="starter_icon border_lock">').wrap('<label class="label_grouped">').click(e.proxy(s.borderLock,s)),this.$element=this.$element.add(s.$lock).find("span:first").prepend(e("<b>").text(s.group.manifest.name+" ")).end()):h.get("border_initialize")(s))},widthChange:function(t){return h.get("sizer_change")(t,this,this.width_property,e.proxy(this.widthChangeAll,this))},widthKeyup:function(t){return h.get("sizer_keyup")(t,this,this.width_property,e.proxy(this.widthChangeAll,this))},widthChangeAll:function(e){return this.propertyUpdateAll("width_property","width",e)},styleChange:function(t){return h.get("select_change")(t,this,this.style_property,e.proxy(this.styleChangeAll,this))},styleChangeAll:function(e){return this.propertyUpdateAll("style_property","style",e)},colorChangeAll:function(e){return this.propertyUpdateAll("color_property","color",e)},propertyUpdateAll:function(t,n,r){var i=this;i.updateCss(i[t],r),n==="width"&&(r=parseInt(r,10)),i.locked&&e.each(i.group.controls.keys,function(e,t){if(t===i.name)return!0;i.group.controls.get(t).fields[n].val(r).change()})},borderLock:function(e){return h.get("border_lock")(e,this)}}),c.add("background",{check:function(e){return f.getSelector(e).property==="background"},init:function(){var t=this.getCss("background-color")||"#000000";this.$element=e('<label class="label_input"><span class="primary_left"></span><input type="text" class="color_right color_picker"></label>'),this.fields.bgcolor=this.$element.find("input.color_picker").val(t),this.setTitle(this.$element.find("span:first")),h.get("colorpicker_initialize")(this,this.fields.bgcolor,"background-color")}}),c.add("4_sided_sizer",{check:function(t){return e.inArray(f.getSelector(t).property,["margin","padding"])!==-1},init:function(){var t=this,n=t.getSelector(),r=["top","right","bottom","left"];t.manifest.options&&e.isArray(t.manifest.options.properties)&&(r=t.manifest.options.properties),t.$element=e('<div class="four_sided_container">'),t.$four_sided_labels=e('<div class="four_sided_labels">'),e.each(r,function(i,s){var o=e('<label class="label_input_grouped"><input class="input_right sizer" type="number" min="0" max="100"></label>'),u=e('<span class="sizer_label">'+s.charAt(0).toUpperCase()+s.substr(1)+"</span>"),a=n.property+"-"+s,f=t.getCss(a)||0;i===0&&o.prepend(t.setTitle(e('<span class="primary_left"></span>'))),r.length!==4&&t.properties.push(a),t.fields[a]=o.find("input.sizer").data("builder-property",a).val(parseInt(f,10)).change(e.proxy(t.sizeChange,t)).keyup(e.proxy(t.sizeKeyup,t)),h.get("initialize_sizers")(t.fields[a]),t.$element.append(o),t.$four_sided_labels.append(u)}),t.$element.append(t.$four_sided_labels)},sizeChange:function(t){return h.get("sizer_change")(t,this,e(t.currentTarget).data("builder-property"))},sizeKeyup:function(t){return h.get("sizer_keyup")(t,this,e(t.currentTarget).data("builder-property"))}});var h={events:{},add:function(t,n){e.isFunction(n)||e.error("Invalid event provided"),this.events[t]=n},get:function(t){return e.isFunction(this.events[t])||e.error("Event doesn't exist: "+t),this.events[t]}};h.add("colorpicker_initialize",function(n,r,i,s,o){var u=r.val()||"#000000",a=e('<div class="color_right fb-color-control"><div></div></div>').insertBefore(r).find("div").css("background-color",u);a.ColorPicker(e.extend({onChange:function(e,t,s){h.get("colorpicker_change")("#"+t,n,r,i,o)},onShow:function(i){var s;return r.is(":disabled")||((s=n.builder.design_mode)&&n.builder.toggleDesignMode(!1),n.builder.$element.contents().click(function(r){e(this).unbind(r),e(t.document).mousedown(),s&&n.builder.toggleDesignMode(!0)}),e(i).fadeIn(500)),!1},onHide:function(t){return e(t).fadeOut(500),!1}},s)).ColorPickerSetColor(u),r.change(function(){var t=e(this).val();a.ColorPickerSetColor(t),h.get("colorpicker_change")(t,n,r,i,o)})}),h.add("colorpicker_change",function(t,n,r,i,s){return r.val(t).prev(".fb-color-control").find("div").css("background-color",t),e.isFunction(s)?s(t):n.updateCss(i,t)}),h.add("select_change",function(t,n,r,i){var s=e(t.currentTarget).val();return e.isFunction(i)?i(s):n.updateCss(r,s)}),h.add("initialize_sizers",function(t){t.each(function(){var t=e(this);t.data("oldvalue",t.val())})}),h.add("sizer_change",function(t,n,r,i){var s=e(t.currentTarget),o=parseInt(s.attr("min"),10),u=parseInt(s.attr("max"),10),a=s.val();return/^\d+$/.test(a)?(a=parseInt(a,10),!isNaN(o)&&a<o?h.get("sizer_reset")(t,n,r,i,"The minimum allowed value is "+o+"."):!isNaN(u)&&a>u?h.get("sizer_reset")(t,n,r,i,"The maximum allowed value is "+u+"."):(s.data("oldvalue",a),e.isFunction(i)?i(a+"px"):n.updateCss(r,a+"px"))):h.get("sizer_reset")(t,n,r,i)}),h.add("sizer_keyup",function(t,n,r,i){var s=e(t.currentTarget),o=parseInt(s.attr("min"),10),u=parseInt(s.attr("max"),10),a=s.val();if(!/^\d+$/.test(a))return;a=parseInt(a,10);if(!isNaN(o)&&a<o||!isNaN(o)&&a>u)return;return e.isFunction(i)?i(a+"px"):n.updateCss(r,a+"px")}),h.add("sizer_reset",function(t,n,r,i,s){var o=e(t.currentTarget),u=o.data("oldvalue")||parseInt(n.getCss(r),10)||0;return typeof s=="string",o.val(u),e.isFunction(i)?i(u+"px"):n.updateCss(r,u+"px")}),h.add("window_resize",function(t,n,r){n.$center.width(e(t.currentTarget.document).width()-n.width),e.isFunction(r)&&r()}),h.add("text_change",function(t,n,r){var i=e(t.currentTarget).val();return e.isFunction(r)?r(i):n.updateTextElement(i)}),h.add("shadow_change",function(t,n,r){if(!t.fields.checkbox.is(":checked"))return;var i="rgba("+t.getRgb(t.fields.color.val())+", "+t.fields.opacity.val()/100+") "+t.fields.x.val()+"px "+t.fields.y.val()+"px "+t.fields.blur.val()+"px 0";return e.isFunction(r)?r(i):t.updateCss(n,i)}),h.add("shadow_checkbox",function(t,n,r){var i=t.fields.checkbox.is(":checked");return e.each(t.fields,function(e,t){e!=="checkbox"&&t.attr("disabled",!i)}),i?h.get("shadow_change")(t,n,r):t.updateCss(n,"none")}),h.add("subpanels_change",function(t,n){var r=(t.width-n.panels.length+1)/n.panels.length;e.each(n.panels.items,function(e,t){t.$title.removeClass("last").css("width",r+"px")}),n.panels.get(n.panels.length-1).$title.addClass("last")}),h.add("border_lock",function(t,n){var r={};n.locked=!n.locked,n.$lock.removeClass("border_lock border_unlock").addClass("border_"+(n.locked?"lock":"unlock")),e.each(n.group.controls.keys,function(t,i){var s=n.group.controls.get(i);e.each(["width","style","color"],function(e,t){i===n.name?r[t]=s.fields[t].val():n.locked?s.fields[t].val(r[t]).change().attr("disabled",!0):s.fields[t].removeAttr("disabled")})})}),h.add("border_initialize",function(t){var n=t.group.controls.get(0);if(!n.locked)return;e.each(["width","style","color"],function(e,r){if(t.fields[r].val()!==n.fields[r].val())return n.$lock.click(),!1;t.fields[r].attr("disabled",!0)})}),h.add("repeat_change",function(t,n,r,i){var s=e(t.currentTarget).val();return n.fields.hidden_repeat.val(s),e.isFunction(i)?i(s):n.updateCss(r,s)}),h.add("position_xy",function(t,n,r){var i=t.fields.position.attr("value"),s="0% 0%",o="0%",u="0%",a,f;return t.name==="background_regular"?(a=t.builder.panels.get("body").panels.get("hover").controls.get("background_hover"),f=t.builder.panels.get("body").panels.get("selected").controls.get("background_selected")):t.name==="background_icon"&&(a=t.builder.panels.get("body").panels.get("hover").controls.get("background_icon_hover"),f=t.builder.panels.get("body").panels.get("selected").controls.get("background_icon_selected")),a&&!a.fields.check_hover.is(":checked")&&a.fields.position.val(i),f&&!f.fields.check_hover.is(":checked")&&f.fields.position.val(i),i==="left"||i==="right"||i==="center"?(t.fields.spinleft.attr("disabled","disabled"),t.fields.spinright.attr("disabled","disabled"),a&&(a.fields.spinleft.attr("disabled","disabled"),a.fields.spinright.attr("disabled","disabled")),f&&(f.fields.spinleft.attr("disabled","disabled"),f.fields.spinright.attr("disabled","disabled")),i==="left"?s="0% 10%":i==="right"?s="95% 10%":i==="center"&&(s="50% 10%")):(t.fields.spinleft.removeAttr("disabled"),t.fields.spinright.removeAttr("disabled"),t.fields.spinleft.val()&&(o=t.fields.spinleft.val()+"%",a&&!a.fields.check_hover.is(":checked")&&a.fields.spinleft.val(t.fields.spinleft.val()),f&&!f.fields.check_hover.is(":checked")&&f.fields.spinleft.val(t.fields.spinleft.val())),t.fields.spinright.val()&&(u=t.fields.spinright.val()+"%",a&&!a.fields.check_hover.is(":checked")&&a.fields.spinright.val(t.fields.spinright.val()),f&&!f.fields.check_hover.is(":checked")&&f.fields.spinright.val(t.fields.spinright.val())),s=o+" "+u),e.isFunction(r)?r(s):t.updateCss(n,s)}),h.add("change_background_color",function(t,n,r){var i=t.fields.bgcolor.val()+" !important";return e.isFunction(r)?r(i):t.updateCss(n,i)}),h.add("background_checkbox",function(e,t,n){var r=e.fields.checkbox.is(":checked"),i=e.fields.bgcolor.val();if(e.name==="background_regular"){var s=e.builder.panels.get("body").panels.get("hover").controls.get("background_hover");r?s.fields.checkbox.attr("checked","checked"):s.fields.checkbox.removeAttr("checked"),h.get("colorpicker_change")(i,s,s.fields.bgcolor,"color"),s.fields.bgcolor.val(i)}return r?e.fields.hidden_color.val("transparent"):e.fields.hidden_color.val(i),r?e.updateCss(t,"transparent !important"):h.get("change_background_color")(e,t,n)}),h.add("delete_background",function(t,r,i){var s=t.fields.field_element.val()==="",o,u,a="none";return s||alert("Delete successfully"),t.fields.hidden_delete_file.val()!==n&&(e.ajax({url:"action/deleteFile.php",type:"POST",data:{filepath:t.fields.hidden_delete_file.val()}}),t.name==="background_regular"?(o=t.builder.panels.get("body").panels.get("hover").controls.get("background_hover"),u=t.builder.panels.get("body").panels.get("selected").controls.get("background_selected")):t.name==="background_icon"&&(o=t.builder.panels.get("body").panels.get("hover").controls.get("background_icon_hover"),u=t.builder.panels.get("body").panels.get("selected").controls.get("background_icon_selected")),o&&!o.fields.check_hover.is(":checked")&&(o.$element.find("input:text").val(""),o.updateCss(r,a)),u&&!u.fields.check_hover.is(":checked")&&(u.$element.find("input:text").val(""),u.updateCss(r,a)),t.fields.hidden_file.val("")),t.fields.spinleft!==n&&(t.fields.spinleft.val(0),t.fields.spinright.val(0)),e.isFunction(i)?i(a):t.updateCss(r,a)}),h.add("get_value_background_hover",function(e){var t=e.builder.panels.get("body").panels.get("regular").controls.get("background_regular");h.get("colorpicker_change")(t.fields.bgcolor.val()+" !important",e,e.fields.bgcolor,"background-color");var n=t.fields.checkbox.is(":checked");n?e.fields.checkbox.attr("checked","checked"):e.fields.checkbox.removeAttr("checked")});var p=["activatePanel","activateSubPanel","addPanel","change","disable","enable","next","prev","refresh","removePanel","toggleDesignMode","addSubPanel","addControlToPanel","addControlToSubPanel","removeSubPanel","removeControlFromPanel","removeControlFromSubPanel"],d=["getStyleSheet","getStyleSheetForPanel","getStyleSheetForPanelControl","getStyleSheetForSubPanel","getStyleSheetForSubPanelControl","data","dataForPanel","dataForPanelControl","dataForSubPanel","dataForSubPanelControl"],v={events:{object:h,methods:["add"]},controls:{object:c,methods:["add"]},notifications:{object:i,methods:["addObserver","removeObserver","postNotification"]}};e.fn.coffeeBuilder=function(t){var n=this.data("coffeeBuilder");n||this.data("coffeeBuilder",n=new o(this,t));if(typeof t=="string"){if(e.inArray(t,d)!==-1)return n[t].apply(n,Array.prototype.slice.call(arguments,1));e.inArray(t,p)!==-1?n[t].apply(n,Array.prototype.slice.call(arguments,1)):e.error("Method "+t+" does not exist on jQuery.fn.coffeeBuilder")}return this},e.coffeeBuilder=function(t){var n=e(t);return n.coffeeBuilder.apply(n,Array.prototype.slice.call(arguments,1))},e.each(v,function(t,n){e.coffeeBuilder[t]=function(r){if(e.inArray(r,n.methods)!==-1)return n.object[r].apply(n.object,Array.prototype.slice.call(arguments,1));e.error("Method "+r+" does not exist on jQuery.coffeeBuilder."+t)}})}(jQuery,window);